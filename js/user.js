// Generated by CoffeeScript 1.4.0
(function() {
  var User, _ref,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  if ((_ref = window.birdseye) == null) {
    window.birdseye = {};
  }

  User = (function() {

    User.prototype.status = ko.observable("signed-out");

    User.prototype.name = ko.observable();

    User.prototype.organisationIds = ko.observableArray();

    function User() {
      this._update = __bind(this._update, this);

      this._error = __bind(this._error, this);

      this._signIn = __bind(this._signIn, this);

      this._clear = __bind(this._clear, this);

      this.signOut = __bind(this.signOut, this);

      this.freshSignIn = __bind(this.freshSignIn, this);

      var _this = this;
      this.signedIn = ko.computed(function() {
        return _this.status() === "signed-in";
      });
    }

    User.prototype.freshSignIn = function() {
      this._clear();
      this.signOut();
      return this._signIn();
    };

    User.prototype.signOut = function() {
      Trello.deauthorize();
      return this.status("signed-out");
    };

    User.prototype._clear = function() {
      this.name(null);
      return this.organisationIds([]);
    };

    User.prototype._signIn = function() {
      var _this = this;
      this.status("signing-in");
      return Trello.authorize({
        type: "popup",
        name: "Birds eye",
        success: function() {
          _this.status("signed-in");
          return _this._update();
        },
        error: this._error
      });
    };

    User.prototype._error = function(m) {
      this.signOut();
      return console.log("Error: " + m);
    };

    User.prototype._update = function() {
      var _this = this;
      this._clear();
      return Trello.members.get("me", {}, function(user) {
        _this.name(user.fullName);
        return _this.organisationIds(user.idOrganizations);
      }, this._error);
    };

    return User;

  })();

  window.birdseye.User = User;

}).call(this);
